---
title: 前端部署 Berstra Modern Website Stack
description: Next.js (App Router + Tailwind + Framer Motion) + Strapi CMS + PostgreSQL
published: true
date: 2025-10-30T12:27:01.331Z
tags: 
editor: markdown
dateCreated: 2025-10-30T06:27:15.645Z
---

# Next.js (App Router + Tailwind + Framer Motion) + Strapi CMS + PostgreSQL

~/berstra-stack/
├── docker-compose.yml          # 一键启动
├── nextjs/                     # 前端源代码（Next.js + Tailwind + Framer Motion）
├── strapi/                     # 后端 CMS（Strapi）
└── .env                        # 全局变量（邮箱、数据库密码等）


graph TD
A[Ubuntu OS]
A --> B[Docker Engine]
B --> C[PostgreSQL]
B --> D[Strapi CMS]
B --> E[Next.js Frontend]
D --> C
E --> D
B --> F[Cloudflare Tunnel]
F --> |Public Access| E
F --> |Public Access| D



# 🧠 Berstra Stack — Modern Web Deployment Summary  
*(Next.js + Strapi + PostgreSQL + Cloudflare Tunnel)*  

---

## 📍 Overview  
This document summarizes the **modern full-stack web deployment** environment on your **Xeon 16-core / 64 GB Ubuntu 22.04** server.  
The stack provides a modular, containerized setup capable of hosting both CMS and dynamic front-end applications under the `berstra.com` domain.

---

## 🧩 Core Components  

| Layer | Component | Purpose | Status |
|--------|------------|----------|---------|
| **Operating System** | Ubuntu 22.04 LTS | Base system, networking, process management | ✅ |
| **Container Engine** | Docker 28.5.1 + Compose v2.40.2 | Container orchestration | ✅ |
| **Database** | PostgreSQL 15 | Persistent CMS data storage | ✅ |
| **Backend CMS** | Strapi (latest) | Headless content API / Admin backend | ✅ |
| **Frontend Framework** | Next.js 15 (App Router) + TailwindCSS | SEO-optimized dynamic React frontend | 🟢 Planned / Deploying |
| **Reverse Proxy / Security** | Cloudflare Zero Trust Tunnel | HTTPS ingress for subdomains (`cms`, `site`, etc.) | ✅ |
| **Version Control / Automation** | Git + Docker Compose + systemd | Unified lifecycle management | ✅ |

---


🔧 Maintenance Commands
# Check logs
docker compose logs -f strapi
docker compose logs -f nextjs

# Restart stack
docker compose restart

# Stop all containers
docker compose down

# Update images
docker compose pull && docker compose up -d



# Berstra Headless Stack 状态记录

## 1. 组成
- Postgres: 5432 (容器: `berstra-postgres`)
- Strapi CMS: 1337 (容器: `berstra-strapi`)
- Next.js 前端: 3100 (容器: `berstra-nextjs`)
- Cloudflare Tunnel: 把域名指向本机各端口

## 2. 域名 ↔ 服务
- https://cms.berstra.com → http://127.0.0.1:1337 → Strapi admin
- https://site.berstra.com → http://127.0.0.1:3100 → Next.js

## 3. Docker
- `sudo docker compose -f ~/berstra-stack/docker-compose.yml up -d`
- `sudo docker ps` 能看到三个容器都在跑
- 日志：
  - `docker logs -f berstra-strapi`
  - `docker logs -f berstra-nextjs`

## 4. Cloudflared（/etc/cloudflared/config.yml 大概是这样）
```yaml
tunnel: <你的-tunnel-id>
credentials-file: /etc/cloudflared/<你的-tunnel-id>.json

ingress:
  - hostname: cms.berstra.com
    service: http://127.0.0.1:1337
  - hostname: site.berstra.com
    service: http://127.0.0.1:3100
  - service: http_status:404
  
 ``` 
  
  
  
  
# 基本命令
- https://cms.berstra.com → http://127.0.0.1:1337 → Strapi admin
# 🧠 Berstra Server 日常运维命令速查表

## 📦 Docker Stack 管理

```bash
# 查看当前容器运行状态
sudo docker ps

# 查看日志（实时）
docker logs -f berstra-nextjs
docker logs -f berstra-strapi
docker logs -f berstra-postgres

# 启动/关闭整个堆栈
sudo docker compose -f ~/berstra-stack/docker-compose.yml up -d
sudo docker compose -f ~/berstra-stack/docker-compose.yml down

# 重启指定容器
sudo docker restart berstra-nextjs
sudo docker restart berstra-strapi
sudo docker restart berstra-postgres



# 查看所有隧道状态
sudo cloudflared tunnel list

# 查看当前隧道日志
sudo journalctl -u cloudflared -f

# 检查服务是否正常
sudo systemctl status cloudflared

# 重启 Cloudflare 隧道服务（最常用）
sudo systemctl restart cloudflared

# 启动/停止
sudo systemctl start cloudflared
sudo systemctl stop cloudflared

# 查看隧道配置路径（一般位于）
cat /etc/cloudflared/config.yml

# 测试本地访问端口是否通
curl -I http://127.0.0.1:1337   # Strapi
curl -I http://127.0.0.1:3105   # Next.js



# 查看当前网络接口状态
nmcli device status

# 重启网络管理器（相当于重连 Wi-Fi）
sudo systemctl restart NetworkManager

# 查看可用 Wi-Fi 列表
nmcli dev wifi list

# 连接 Wi-Fi
nmcli dev wifi connect "你的WiFi名称" password "你的密码"

# 检查 IP / 网关
ip addr show
ip route show

# 测试外网连接
ping -c 4 1.1.1.1      # Cloudflare DNS
ping -c 4 google.com


# 查看 CPU / 内存 / 磁盘 使用
htop                   # 交互式监控（需安装）
free -h                # 内存
df -h                  # 磁盘

# 查看指定进程占用端口
sudo ss -ltnp | grep 3000
sudo ss -ltnp | grep 1337

# 检查服务器时间与时区
timedatectl


# Cloudflare Error 1033 → 隧道掉线
sudo systemctl restart cloudflared

# Docker 容器起不来
sudo docker compose down && sudo docker compose up -d

# Next.js 报端口占用
sudo ss -ltnp | grep 3100
sudo kill <PID>

# Wi-Fi 掉线
sudo systemctl restart NetworkManager