---
title: å‰ç«¯éƒ¨ç½² Berstra Modern Website Stack
description: Next.js (App Router + Tailwind + Framer Motion) + Strapi CMS + PostgreSQL
published: true
date: 2025-10-30T12:27:01.331Z
tags: 
editor: markdown
dateCreated: 2025-10-30T06:27:15.645Z
---

# Next.js (App Router + Tailwind + Framer Motion) + Strapi CMS + PostgreSQL

~/berstra-stack/
â”œâ”€â”€ docker-compose.yml          # ä¸€é”®å¯åŠ¨
â”œâ”€â”€ nextjs/                     # å‰ç«¯æºä»£ç ï¼ˆNext.js + Tailwind + Framer Motionï¼‰
â”œâ”€â”€ strapi/                     # åç«¯ CMSï¼ˆStrapiï¼‰
â””â”€â”€ .env                        # å…¨å±€å˜é‡ï¼ˆé‚®ç®±ã€æ•°æ®åº“å¯†ç ç­‰ï¼‰


graph TD
A[Ubuntu OS]
A --> B[Docker Engine]
B --> C[PostgreSQL]
B --> D[Strapi CMS]
B --> E[Next.js Frontend]
D --> C
E --> D
B --> F[Cloudflare Tunnel]
F --> |Public Access| E
F --> |Public Access| D



# ğŸ§  Berstra Stack â€” Modern Web Deployment Summary  
*(Next.js + Strapi + PostgreSQL + Cloudflare Tunnel)*  

---

## ğŸ“ Overview  
This document summarizes the **modern full-stack web deployment** environment on your **Xeon 16-core / 64 GB Ubuntu 22.04** server.  
The stack provides a modular, containerized setup capable of hosting both CMS and dynamic front-end applications under the `berstra.com` domain.

---

## ğŸ§© Core Components  

| Layer | Component | Purpose | Status |
|--------|------------|----------|---------|
| **Operating System** | Ubuntu 22.04 LTS | Base system, networking, process management | âœ… |
| **Container Engine** | Docker 28.5.1 + Compose v2.40.2 | Container orchestration | âœ… |
| **Database** | PostgreSQL 15 | Persistent CMS data storage | âœ… |
| **Backend CMS** | Strapi (latest) | Headless content API / Admin backend | âœ… |
| **Frontend Framework** | Next.js 15 (App Router) + TailwindCSS | SEO-optimized dynamic React frontend | ğŸŸ¢ Planned / Deploying |
| **Reverse Proxy / Security** | Cloudflare Zero Trust Tunnel | HTTPS ingress for subdomains (`cms`, `site`, etc.) | âœ… |
| **Version Control / Automation** | Git + Docker Compose + systemd | Unified lifecycle management | âœ… |

---


ğŸ”§ Maintenance Commands
# Check logs
docker compose logs -f strapi
docker compose logs -f nextjs

# Restart stack
docker compose restart

# Stop all containers
docker compose down

# Update images
docker compose pull && docker compose up -d



# Berstra Headless Stack çŠ¶æ€è®°å½•

## 1. ç»„æˆ
- Postgres: 5432 (å®¹å™¨: `berstra-postgres`)
- Strapi CMS: 1337 (å®¹å™¨: `berstra-strapi`)
- Next.js å‰ç«¯: 3100 (å®¹å™¨: `berstra-nextjs`)
- Cloudflare Tunnel: æŠŠåŸŸåæŒ‡å‘æœ¬æœºå„ç«¯å£

## 2. åŸŸå â†” æœåŠ¡
- https://cms.berstra.com â†’ http://127.0.0.1:1337 â†’ Strapi admin
- https://site.berstra.com â†’ http://127.0.0.1:3100 â†’ Next.js

## 3. Docker
- `sudo docker compose -f ~/berstra-stack/docker-compose.yml up -d`
- `sudo docker ps` èƒ½çœ‹åˆ°ä¸‰ä¸ªå®¹å™¨éƒ½åœ¨è·‘
- æ—¥å¿—ï¼š
  - `docker logs -f berstra-strapi`
  - `docker logs -f berstra-nextjs`

## 4. Cloudflaredï¼ˆ/etc/cloudflared/config.yml å¤§æ¦‚æ˜¯è¿™æ ·ï¼‰
```yaml
tunnel: <ä½ çš„-tunnel-id>
credentials-file: /etc/cloudflared/<ä½ çš„-tunnel-id>.json

ingress:
  - hostname: cms.berstra.com
    service: http://127.0.0.1:1337
  - hostname: site.berstra.com
    service: http://127.0.0.1:3100
  - service: http_status:404
  
 ``` 
  
  
  
  
# åŸºæœ¬å‘½ä»¤
- https://cms.berstra.com â†’ http://127.0.0.1:1337 â†’ Strapi admin
# ğŸ§  Berstra Server æ—¥å¸¸è¿ç»´å‘½ä»¤é€ŸæŸ¥è¡¨

## ğŸ“¦ Docker Stack ç®¡ç†

```bash
# æŸ¥çœ‹å½“å‰å®¹å™¨è¿è¡ŒçŠ¶æ€
sudo docker ps

# æŸ¥çœ‹æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
docker logs -f berstra-nextjs
docker logs -f berstra-strapi
docker logs -f berstra-postgres

# å¯åŠ¨/å…³é—­æ•´ä¸ªå †æ ˆ
sudo docker compose -f ~/berstra-stack/docker-compose.yml up -d
sudo docker compose -f ~/berstra-stack/docker-compose.yml down

# é‡å¯æŒ‡å®šå®¹å™¨
sudo docker restart berstra-nextjs
sudo docker restart berstra-strapi
sudo docker restart berstra-postgres



# æŸ¥çœ‹æ‰€æœ‰éš§é“çŠ¶æ€
sudo cloudflared tunnel list

# æŸ¥çœ‹å½“å‰éš§é“æ—¥å¿—
sudo journalctl -u cloudflared -f

# æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸
sudo systemctl status cloudflared

# é‡å¯ Cloudflare éš§é“æœåŠ¡ï¼ˆæœ€å¸¸ç”¨ï¼‰
sudo systemctl restart cloudflared

# å¯åŠ¨/åœæ­¢
sudo systemctl start cloudflared
sudo systemctl stop cloudflared

# æŸ¥çœ‹éš§é“é…ç½®è·¯å¾„ï¼ˆä¸€èˆ¬ä½äºï¼‰
cat /etc/cloudflared/config.yml

# æµ‹è¯•æœ¬åœ°è®¿é—®ç«¯å£æ˜¯å¦é€š
curl -I http://127.0.0.1:1337   # Strapi
curl -I http://127.0.0.1:3105   # Next.js



# æŸ¥çœ‹å½“å‰ç½‘ç»œæ¥å£çŠ¶æ€
nmcli device status

# é‡å¯ç½‘ç»œç®¡ç†å™¨ï¼ˆç›¸å½“äºé‡è¿ Wi-Fiï¼‰
sudo systemctl restart NetworkManager

# æŸ¥çœ‹å¯ç”¨ Wi-Fi åˆ—è¡¨
nmcli dev wifi list

# è¿æ¥ Wi-Fi
nmcli dev wifi connect "ä½ çš„WiFiåç§°" password "ä½ çš„å¯†ç "

# æ£€æŸ¥ IP / ç½‘å…³
ip addr show
ip route show

# æµ‹è¯•å¤–ç½‘è¿æ¥
ping -c 4 1.1.1.1      # Cloudflare DNS
ping -c 4 google.com


# æŸ¥çœ‹ CPU / å†…å­˜ / ç£ç›˜ ä½¿ç”¨
htop                   # äº¤äº’å¼ç›‘æ§ï¼ˆéœ€å®‰è£…ï¼‰
free -h                # å†…å­˜
df -h                  # ç£ç›˜

# æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹å ç”¨ç«¯å£
sudo ss -ltnp | grep 3000
sudo ss -ltnp | grep 1337

# æ£€æŸ¥æœåŠ¡å™¨æ—¶é—´ä¸æ—¶åŒº
timedatectl


# Cloudflare Error 1033 â†’ éš§é“æ‰çº¿
sudo systemctl restart cloudflared

# Docker å®¹å™¨èµ·ä¸æ¥
sudo docker compose down && sudo docker compose up -d

# Next.js æŠ¥ç«¯å£å ç”¨
sudo ss -ltnp | grep 3100
sudo kill <PID>

# Wi-Fi æ‰çº¿
sudo systemctl restart NetworkManager